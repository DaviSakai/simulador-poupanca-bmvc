{% extends "base.html" %}

{% block title %}Minhas Metas{% endblock %}

{% block head %}
<link rel="stylesheet" href="/static/css/metas_base.css?v=1">
<link rel="stylesheet" href="/static/css/metas_lista.css?v=1">

<!-- JS do WebSocket -->
<script defer src="/static/js/metas.js"></script>

<style>
    /* Indicador WebSocket */
    .ws-status-box {
        margin-top: 10px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
        color: var(--text-muted);
    }

    .ws-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: red;
        box-shadow: 0 0 6px red;
        transition: 0.2s;
    }
    .ws-dot.online {
        background: #00c853;
        box-shadow: 0 0 6px #00c853;
    }

    /* Resumo */
    .resumo-box {
        padding: 18px 22px;
        margin-bottom: 20px;
        border-radius: 12px;
        background: var(--glass-bg);
        box-shadow: var(--glass-shadow);
    }
    .resumo-title {
        font-size: 1.2rem;
        margin-bottom: 5px;
    }
    .resumo-line {
        font-size: 0.95rem;
        margin: 3px 0;
    }
</style>

{% endblock %}

{% block content %}

<div class="page">

    <!-- TOPBAR -->
    <div class="topbar glass">
        <div class="topbar-left">
            <div class="logo-dot"></div>
            <div>
                <div class="topbar-sub">BMVC ‚Äî Planejamento</div>
                <h1 class="sim-title">Minhas Metas</h1>
            </div>
        </div>

        <a href="/restrito" class="btn-voltar">‚Üê Dashboard</a>
    </div>

    <!-- STATUS DO WEBSOCKET -->
    <div class="ws-status-box">
        <div id="ws-dot" class="ws-dot"></div>
        <span id="ws-text">Conectando...</span>
    </div>

    <!-- RESUMO EM TEMPO REAL -->
    <div class="glass resumo-box">
        <div class="resumo-title">Resumo em tempo real</div>
        <div class="resumo-line">
            Total de metas: <b><span id="resumo-total">{{ metas|length }}</span></b>
        </div>
        <div class="resumo-line">
            Soma mensal: <b>R$ <span id="resumo-mensal">0,00</span></b>
        </div>
        <div class="resumo-line">
            Soma total projetada: <b>R$ <span id="resumo-total-proj">0,00</span></b>
        </div>
    </div>

    <!-- T√çTULO -->
    <h2 class="list-title">Metas Financeiras</h2>
    <p class="list-desc">Gerencie, edite e consulte todas as suas metas.</p>

    <!-- BOT√ÉO CRIAR -->
    <a href="/metas/nova" class="btn-nova">+ Criar nova meta</a>

    <!-- GRID DE CARDS -->
    <div id="metas-grid" class="cards-grid">

        {% for meta in metas %}
        <div class="card glass" data-id="{{ meta.id }}">

            <span class="tag {{ meta.categoria }}">
                {% if meta.categoria == 'curto' %}CURTO PRAZO
                {% elif meta.categoria == 'medio' %}M√âDIO PRAZO
                {% else %}LONGO PRAZO
                {% endif %}
            </span>

            <div class="card-title">{{ meta.nome }}</div>

            <div class="info">ü™ô Valor mensal: <b>R$ {{ "%.2f"|format(meta.valor_mensal) }}</b></div>
            <div class="info">üìÜ Dura√ß√£o: <b>{{ meta.qt_meses }} meses</b></div>
            <div class="info">üìà Juros anual: <b>{{ "%.2f"|format(meta.taxa_juros) }}%</b></div>

            <div class="acoes">
                <a href="/metas/{{ meta.id }}/editar" class="btn-editar">Editar</a>

                <form method="POST" action="/metas/{{ meta.id }}/excluir" style="display:inline;">
                    <button class="btn-excluir">Excluir</button>
                </form>
            </div>

        </div>
        {% endfor %}

    </div>

</div>

{% endblock %}
